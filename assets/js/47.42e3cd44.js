(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{523:function(s,a,t){"use strict";t.r(a);var n=t(42),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("在使用Docker Hub这样的公共仓库时经常会出现网络速度缓慢，申请注册麻烦等等令人头疼的问题。本文将会讲述如何在局域网通过docker搭建私有容器仓库。当然使用私有仓库主要有以下两个优点：")]),s._v(" "),t("p",[s._v("1、节省网络带宽，每个镜像不用每个人都去官网下载，只需要从私有仓库中下载即可。")]),s._v(" "),t("p",[s._v("2、提供镜像资源利用，针对公司内部使用的镜像，推送到本地的私有仓库，供公司内部的人员使用。\n")]),s._v(" "),t("h2",{attrs:{id:"一、环境准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一、环境准备"}},[s._v("#")]),s._v(" 一、环境准备")]),s._v(" "),t("p",[s._v("两台装有docker（尽量保证docker的版本都一致）的Debian9.11（当然其他Linux也是一样的）的虚拟机")]),s._v(" "),t("ul",[t("li",[s._v("虚拟机一：192.168.88.100 用作私有仓库")]),s._v(" "),t("li",[s._v("虚拟机二：192.168.88.101 普通用户机")])]),s._v(" "),t("h2",{attrs:{id:"二、dockerhub搭建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二、dockerhub搭建"}},[s._v("#")]),s._v(" 二、dockerhub搭建")]),s._v(" "),t("p",[s._v("192.168.88.100 私有仓库")]),s._v(" "),t("h3",{attrs:{id:"_1-搭建dockerhub容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-搭建dockerhub容器"}},[s._v("#")]),s._v(" 1. 搭建dockerhub容器")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拉取 registry 镜像")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull registry\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 registry 镜像是否拉取成功")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" images "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" registry\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动 registry 并将仓库数据映射到本地指定目录。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(":5000 -v /docker/registry/:/var/lib/registry/ --name registry --restart"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always registry\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看容器启动情况")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("默认情况下，会将仓库放在容器内的/tmp/registry目录下，这样有个问题，如果容器被删除，则存放在容器中的镜像也会丢失。所以一般情况下建议指定本地一个目录挂载到容器内的/tmp/registry下（新版本是/var/lib/registry）")]),s._v(" "),t("h3",{attrs:{id:"_2-配置私有仓库地址"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置私有仓库地址"}},[s._v("#")]),s._v(" 2. 配置私有仓库地址")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 在 /etc/docker/daemon.json 配置文件中添加 "insecure-registries": [ "192.168.88.100:5000"] 此处IP为私有仓库IP')]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/docker/daemon.json \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry-mirrors"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://eoxejquzx.mirror.aliyuncs.com"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"insecure-registries"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.88.100:5000"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改完成后重启docker服务")]),s._v("\n$ systemctl restart "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h3",{attrs:{id:"_3-提交本地镜像到私有仓库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-提交本地镜像到私有仓库"}},[s._v("#")]),s._v(" 3. 提交本地镜像到私有仓库")]),s._v(" "),t("p",[s._v("docker commit :从容器创建一个新的镜像。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" commit "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OPTIONS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" CONTAINER "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("REPOSITORY"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(":TAG"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("-a :提交的镜像作者；")]),s._v(" "),t("p",[s._v("-c :使用Dockerfile指令来创建镜像；")]),s._v(" "),t("p",[s._v("-m :提交时的说明文字；")]),s._v(" "),t("p",[s._v("-p :在commit时，将容器暂停。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 提交本地容器生成镜像")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" commit -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sleepyocean"')]),s._v(" -m "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"custom-hello-container"')]),s._v(" hello-test-container "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".88.100:5000/cust-hello:v1.0\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看镜像列表")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" images\nREPOSITORY                       TAG                 IMAGE ID            CREATED             SIZE\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".88.100:5000/cust-hello   v1.0                403e0f82a578        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" seconds ago       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(".2MB\nregistry                         latest              2d4f4b5309b1        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" months ago        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(".2MB\nhello-world                      latest              bf756fb1ae65        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" months ago        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(".3kB\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 推送镜像到私有仓库")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".88.100:5000/cust-hello:v1.0\nThe push refers to repository "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".88.100:5000/cust-hello"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n0d635023c749: Pushed \nb3f4654534d1: Pushed \na5f34560cdd9: Pushed \n2393466513b5: Pushed \nf5b92gte0e42: Pushed \n3e789b409db3: Pushed \nv1.0: digest: sha256:881141c72bbf0e0f848239cf97266e5865632467b78f0a46b943bf5b9324991f size: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1570")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("h2",{attrs:{id:"三、拉取私有仓库镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三、拉取私有仓库镜像"}},[s._v("#")]),s._v(" 三、拉取私有仓库镜像")]),s._v(" "),t("p",[s._v("192.168.88.101 普通用户机")]),s._v(" "),t("h3",{attrs:{id:"_1-配置私有仓库地址"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-配置私有仓库地址"}},[s._v("#")]),s._v(" 1. 配置私有仓库地址")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 在 /etc/docker/daemon.json 配置文件中添加 "insecure-registries": [ "192.168.88.100:5000"] 此处IP为私有仓库IP')]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/docker/daemon.json \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry-mirrors"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://eoxejquzx.mirror.aliyuncs.com"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"insecure-registries"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.88.100:5000"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改完成后重启docker服务")]),s._v("\n$ systemctl restart "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h3",{attrs:{id:"_2-拉取镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-拉取镜像"}},[s._v("#")]),s._v(" 2. 拉取镜像")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拉取私有镜像")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".88.100:5000/cust-hello:v1.0\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看拉取镜像")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" images\nREPOSITORY                       TAG                 IMAGE ID            CREATED                  SIZE\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".88.100:5000/cust-hello   v1.0                403e0f82a578        Less than a second ago   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(".2MB\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);